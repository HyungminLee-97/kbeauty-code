<!-- MoCRA 등록지원 -->
<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>News</title>
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico" />
    <!--파비콘-->
    <meta property="og:image" content="images/logo.jpg" />
    <!--링크 이미지-->
    <meta property="og:title" content="Your Best K-Beauty Partner in U.S.A." />
    <!--링크 타이틀-->
    <meta
      property="og:description"
      content="Your Best K-Beauty Business Partner"
    />
    <!--링크 세부정보-->
    <!-- Bootstrap 5 CSS 파일 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="css/main.css">
  </head>
  <body>
    <!-- nav -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
          <a class="navbar-brand" href="index.html">
            <img src="images/logo.png" alt="GI Futures 로고" style="width: 100px; height: 100px;">
          </a>
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav">
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="navbarDropdownMenuLink"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  회사 소개
                </a>
                <ul
                  class="dropdown-menu"
                  aria-labelledby="navbarDropdownMenuLink"
                >
                  <li>
                    <a class="dropdown-item" href="introduce.html">인사말</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="address.html">오시는 길</a>
                  </li>
                </ul>
              </li>
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="navbarDropdownMenuLink"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  사업 소개
                </a>
                <ul
                  class="dropdown-menu"
                  aria-labelledby="navbarDropdownMenuLink"
                >
                  <li>
                    <a class="dropdown-item" href="mocra.html">MoCRA 등록지원</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="wholesale.html"
                      >Wholesale in USA</a
                    >
                  </li>
                  <li>
                    <a class="dropdown-item" href="3pl.html">3PL in USA</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="warehouse.html">Warehouse</a>
                  </li>
                </ul>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="partnership.html">파트너쉽</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="news.html">News</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="help.html">고객 문의</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

    <!-- 본문 -->
    <div class="container" style="margin-top: 20px;">
        <h1>News</h1>
        <h7>Home > News</h7>
    </div>
    <div class="container custom-container">
        <div class="container">
            <div class="detail-pic my-4" style="background-image: url('');"></div>
            <div>
              <h5 class="title"></h5>
              <h6 class="date"></h6>
              <hr>
              <p class="content"></p>
            </div>
        </div>
        <button class="btn btn-outline-secondary" id="edit">수정</button>
        <button class="btn btn-outline-secondary" id="delete">삭제</button>
    </div>

    <!-- footer -->
    <div class="container">
        <div class="card" style="margin-top: 20px; line-height: 0.3;">
            <div class="card-header" style="font-size: 18px; letter-spacing: -2px;"> <!-- Header 폰트 크기와 자간 조절 -->
            회사 소개
            </div>
            <div class="card-body" style="font-size: 14px; letter-spacing: -1px;"> <!-- Body 폰트 크기와 자간 조절 -->
            <h5 class="card-title">GI Futures</h5>
            <p class="card-text">Your Best K-Beauty Business Partner</p>
            <p class="card-text"><b>대표:</b> </p> 
            <p class="card-text"><b>사업자등록번호:</b> </p> 
            <p class="card-text"><b>주소:</b> 서울특별시 동대문구 이문로 107, 611호</p>
            <p class="card-text"><b>통신판매업신고번호:</b> </p>
            <p class="card-text"><b>개인정보관리자:</b> </p>
            <p class="card-text"><b>대표메일:</b> </p>   
            <p class="card-text"><b><a href="admin.html" style="color: grey; text-decoration: none;">관리자페이지</a></b></p>
            <p class="card-text" style="font-size: 12px; letter-spacing: -0.1px; line-height: 1;"><b>© GI Futures, ALL RIGHTS RESERVED.</b></p> <!-- Footer 내의 특정 텍스트 폰트 크기와 자간 조절 -->
            </div>
        </div>
    </div>

    <!-- 하단부 전부 firebase 관련 코드 -건들지 말 것 -->
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-analytics.js"></script>

    <!-- bootstrap5 설치 -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
      crossorigin="anonymous"
    ></script>

    <!-- jquery3 설치 -->
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyDDeBsagd24jikTtRYkWiiLetwfcMS_2Iw",
        authDomain: "kbeauty-7cb9c.firebaseapp.com",
        projectId: "kbeauty-7cb9c",
        storageBucket: "kbeauty-7cb9c.appspot.com",
        messagingSenderId: "138758016371",
        appId: "1:138758016371:web:96ad5e6de1e728a2ca8906",
        measurementId: "G-14PV04Z4YP",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      //뉴스 글 불러오기
      const db = firebase.firestore();
      const storage = firebase.storage();

      let title;
      let content;
      let date;
      let url;

      let queryString = new URLSearchParams(window.location.search);

      db.collection("news")
        .doc(queryString.get("id"))
        .get()
        .then((result) => {
          console.log(result.data());
          productID = queryString.get("id");
          title = result.data().title;
          content = result.data().content;
          date = result.data().date;
          url = result.data().file;

          $(".title").html(result.data().title);
          $(".content").html(result.data().content);
          $(".date").html(result.data().date.toDate().toLocaleString());
          $(".detail-pic").css("background-image", `url('${url || 'images/logo.png'}')`);
        });


        // 로그인 uid
        const user = JSON.parse(localStorage.getItem("user"));
        const login_uid = user ? user.uid : null;
        console.log("login uid: ", login_uid);

        // 뉴스 글 불러오기
        db.collection("news")
          .doc(queryString.get("id"))
          .get()
          .then((result) => {
            console.log(result.data());
            productID = queryString.get("id");
            title = result.data().title;
            content = result.data().content;
            date = result.data().date;
            url = result.data().file;

            $(".title").html(result.data().title);
            $(".content").html(result.data().content);
            $(".date").html(result.data().date.toDate().toLocaleString());
            $(".detail-pic").css("background-image", `url('${url || 'images/logo.png'}')`);

            //업로더 uid
            uploader_uid = result.data().uploader_uid;
            console.log('uploader uid: ', uploader_uid)

            // 로그인 uid가 존재하고, 로그인 uid와 업로더 uid가 일치할 시 -> 삭제/수정 버튼 표시
            if (login_uid && login_uid === 'PAmHZtKNrbQCkma4Eb1k5M8yTbx1') {
              document.getElementById("edit").style.display = "";
              document.getElementById("delete").style.display = "";
            } else {
              // 그렇지 않을 경우 -> 삭제/수정 버튼 감춤
              document.getElementById("edit").style.display = "none";
              document.getElementById("delete").style.display = "none";
            }
          });
      
          //수정 기능
          $("#edit").click(function () {
            window.location.href = "news-edit.html?id=" + queryString.get("id");
          });
          //삭제 기능
          $("#delete").click(function () {
            if (!confirm("삭제 하시겠습니까?")) {
              alert("취소했습니다.");
            } else {
              db.collection("news")
                .doc(queryString.get("id"))
                .delete()
                .then(() => {
                  console.log("삭제 완료");
                  alert("삭제가 완료되었습니다.");
                });

              // 이미지가 존재할 때만 삭제 수행
              if (url) {
                let imageRef = storage.refFromURL(url);
                imageRef.delete();
              }

              setTimeout(() => (window.location.href = "news.html"), 1500);
            }
          });
    </script>
  </body>
</html>