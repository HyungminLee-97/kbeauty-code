<!-- pagination은 작동함 -->
<!-- 하지만, 상세페이지 접속이 안되는 상태 -->
<!-- 문서 id를 가지고 오질 못함 -->

<!-- News -->
<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>News</title>
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico" />
    <!--파비콘-->
    <meta property="og:image" content="images/logo.jpg" />
    <!--링크 이미지-->
    <meta property="og:title" content="Your Best K-Beauty Partner in U.S.A." />
    <!--링크 타이틀-->
    <meta
      property="og:description"
      content="Your Best K-Beauty Business Partner"
    />
    <!--링크 세부정보-->
    <!-- Bootstrap 5 CSS 파일 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="css/main.css" />
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- 로고 이미지 -->
    <div class="d-flex justify-content-md-center">
      <a class="navbar-brand" href="index.html">
        <img src="images/logo.png" alt="GI Futures 로고" style="width: 150px" />
      </a>
    </div>
    <!-- nav -->
    <nav
      class="navbar navbar-expand-lg navbar-light"
      aria-label="Tenth navbar example"
    >
      <div class="container-fluid">
        <button
          class="navbar-toggler collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarsExample08"
          aria-controls="navbarsExample08"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div
          class="navbar-collapse justify-content-md-center collapse"
          id="navbarsExample08"
        >
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdownMenuLink"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                회사 소개
              </a>
              <ul
                class="dropdown-menu"
                aria-labelledby="navbarDropdownMenuLink"
              >
                <li>
                  <a class="dropdown-item" href="introduce.html">인사말</a>
                </li>
                <li>
                  <a class="dropdown-item" href="address.html">오시는 길</a>
                </li>
              </ul>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdownMenuLink"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                사업 소개
              </a>
              <ul
                class="dropdown-menu"
                aria-labelledby="navbarDropdownMenuLink"
              >
                <li>
                  <a class="dropdown-item" href="mocra.html">MoCRA 등록지원</a>
                </li>
                <li>
                  <a class="dropdown-item" href="wholesale.html"
                    >Wholesale in USA</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="3pl.html">3PL in USA</a>
                </li>
                <li>
                  <a class="dropdown-item" href="warehouse.html">Warehouse</a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="partnership.html">파트너쉽</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="news.html">News</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="help.html">고객 문의</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- 본문 -->
    <div class="container" style="margin-top: 20px">
      <h1>News</h1>
      <h7>Home > News</h7>
    </div>
    <!-- 본문 내용 삽입 -->
    <div class="news">
      <!-- 하단 javascript 통해서 자동 게시 -->
    </div>
    <br />
    <!-- pagination 추가 -->
    <div class="container">
      <ul class="pagination justify-content-center">
        <nav aria-label="Page navigation example" style="display: flex">
          <button class="btn btn-secondary" id="prev-btn"><</button>
          <ul
            class="pagination justify-content-center"
            id="pagination-container"
          >
            <!-- Pagination이 여기에 동적으로 생성될 것입니다. -->
          </ul>
          <button class="btn btn-secondary" id="next-btn">></button>
        </nav>
      </ul>
    </div>

    <!-- footer -->
    <div class="container">
      <div class="card" style="margin-top: 20px; line-height: 0.3">
        <div class="card-header" style="font-size: 18px; letter-spacing: -2px">
          <!-- Header 폰트 크기와 자간 조절 -->
          회사 소개
        </div>
        <div class="card-body" style="font-size: 14px; letter-spacing: -1px">
          <!-- Body 폰트 크기와 자간 조절 -->
          <h5 class="card-title">GI Futures</h5>
          <p class="card-text">Your Best K-Beauty Business Partner</p>
          <p class="card-text"><b>대표: </b>강성민, 정상욱</p>
          <p class="card-text"><b>사업자등록번호: </b>362-81-03073</p>
          <p class="card-text">
            <b>주소: </b>서울특별시 동대문구 이문로 107, 607호
          </p>
          <p class="card-text"><b>개인정보관리자: </b>정지현</p>
          <p class="card-text"><b>담당자 전화번호: </b>010-6393-4870</p>
          <p class="card-text"><b>대표메일: </b>gifutures@hanmail.net</p>
          <p class="card-text">
            <b
              ><a href="admin.html" style="color: grey; text-decoration: none"
                >관리자페이지</a
              ></b
            >
          </p>
          <p
            class="card-text"
            style="font-size: 12px; letter-spacing: -0.1px; line-height: 1"
          >
            <b>© GI Futures, ALL RIGHTS RESERVED.</b>
          </p>
          <!-- Footer 내의 특정 텍스트 폰트 크기와 자간 조절 -->
        </div>
      </div>
    </div>

    <!-- 하단부 전부 firebase 관련 코드 -건들지 말 것 -->
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-analytics.js"></script>

    <!-- bootstrap5 설치 -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
      crossorigin="anonymous"
    ></script>

    <!-- jquery3 설치 -->
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyDDeBsagd24jikTtRYkWiiLetwfcMS_2Iw",
        authDomain: "kbeauty-7cb9c.firebaseapp.com",
        projectId: "kbeauty-7cb9c",
        storageBucket: "kbeauty-7cb9c.appspot.com",
        messagingSenderId: "138758016371",
        appId: "1:138758016371:web:96ad5e6de1e728a2ca8906",
        measurementId: "G-14PV04Z4YP",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      // 뉴스 가져오기
      const db = firebase.firestore();
      db.collection("news")
        .orderBy("date", "desc")
        .get()
        .then((result) => {
          const container = $(".news");
          const newsData = [];

          result.forEach((doc) => {
            const newsItem = doc.data();
            newsItem.id = doc.id;
            newsData.push(newsItem);
          });

          // pagination 설정 부분
          const itemsPerPage = 5;
          const paginationContainer = $("#pagination-container");
          const prevButton = $("#prev-btn");
          const nextButton = $("#next-btn");
          const totalPages = Math.ceil(newsData.length / itemsPerPage);

          // Pagination 생성 부분
          for (let i = 1; i <= totalPages; i++) {
            const paginationItem = `<li class="page-item"><a class="page-link" href="#" data-page="${i}">${i}</a></li>`;
            paginationContainer.append(paginationItem);
          }

          // 첫 페이지 로딩
          showNewsPage(1, newsData);

          // 페이지 클릭 이벤트를 document 전체에 걸어서 처리
          $(document).on(
            "click",
            "#pagination-container .page-link",
            function (e) {
              e.preventDefault();
              const selectedPage = parseInt($(this).data("page"));
              showNewsPage(selectedPage, newsData);
              $("html, body").animate(
                {
                  scrollTop: $(".container").offset().top,
                },
                "slow"
              );
            }
          );

          // 이전 버튼 클릭 이벤트 처리
          prevButton.on("click", function () {
            const currentPage = parseInt(
              paginationContainer.find(".active").text()
            );
            if (currentPage > 1) {
              showNewsPage(currentPage - 1, newsData);
            }
          });

          // 다음 버튼 클릭 이벤트 처리
          nextButton.on("click", function () {
            const currentPage = parseInt(
              paginationContainer.find(".active").text()
            );
            if (currentPage < totalPages) {
              showNewsPage(currentPage + 1, newsData);
            }
          });

          //showPagination 함수 추가
          function showPagination(currentPage, totalPages) {
            paginationContainer.empty();

            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, startPage + 4);

            for (let i = startPage; i <= endPage; i++) {
              const paginationItem = `<li class="page-item ${
                i === currentPage ? "active" : ""
              }"><a class="page-link" href="#" data-page="${i}">${i}</a></li>`;
              paginationContainer.append(paginationItem);
            }
          }

          function showNewsPage(page, data) {
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentPageData = data.slice(startIndex, endIndex);

            container.empty();

            currentPageData.forEach((item) => {
              const imageUrl = item.file || "images/logo.png";
              const news_template = `<div class="container mt-3">
              <div class="custom-container">
                <div class="product">
                  <div class="thumbnail" style="background-image: url('${imageUrl}')"></div>
                  <div class="flex-grow-1 p-4">
                    <h5 class="title"><a href="news-detail.html?id=${
                      item.id
                    }">${item.title}</a></h5>
                    <p class="date">${item.date.toDate().toLocaleString()}</p>
                  </div>
                </div>
              </div>
            </div>`;
              container.append(news_template);

              //console에 아이템 출력
              console.log(item);

              // custom-container 클릭 시 링크 이동
              container.on("click", ".custom-container", function () {
                const link = $(this).find(".title a").attr("href");
                window.location.href = link;
              });
            });

            // Pagination 및 Previous, Next 버튼 활성화 처리
            showPagination(page, totalPages);

            if (page === 1) {
              prevButton.prop("disabled", true);
            } else {
              prevButton.prop("disabled", false);
            }

            if (page === totalPages) {
              nextButton.prop("disabled", true);
            } else {
              nextButton.prop("disabled", false);
            }
          }
        });
    </script>
  </body>
</html>
